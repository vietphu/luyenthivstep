<!DOCTYPE html><html lang="vi" data-bs-theme="auto"><head>
	<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/assets/image/favicon/favicon.ico" type="image/x-icon">
<title>Luyện đề Nói VSTEP | Luyện đề VSTEP</title>
<link rel="stylesheet" href="/assets/theme/dashkit/assets/css/theme.bundle.css">
<link rel="stylesheet" href="/assets/datatables/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="/assets/css/user.css">

<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3SBM3LJGHF"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-3SBM3LJGHF');
</script>	<style type="text/css">
	#offcanvasTranslation {
		width: 100%;
		max-width: none;
	}
	@media (min-width: 992px) {
		#offcanvasTranslation {
			width: 70% !important;
			max-width: 700px;
		}
	}
	connection {
		border: 2px solid;
		color: #2c7be5;
	}
</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light ">
	<div class="container">
		<!-- Nút thu gọn menu trên mobile -->
		<button class="navbar-toggler me-auto" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Mở menu điều hướng">
			<span class="navbar-toggler-icon"></span>
		</button>

		<!-- Logo trang web -->
		<a class="navbar-brand me-auto order-lg-first" href="/">
			<img src="/assets/image/luyenthivstep-logo.webp" width="24" height="24" alt="Logo Luyện thi VSTEP" class="navbar-brand-img">
			<span class="ps-1 color-brand fw-bold">LUYỆN THI VSTEP</span>
		</a>

		<div class="navbar-user order-lg-1">
											<div class="dropdown">
					<a href="#" class="avatar avatar-sm avatar-online dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<span class="avatar-title rounded-circle">
							PH						</span>
					</a>
					<div class="dropdown-menu dropdown-menu-end mt-2 shadow-sm border-0">
						<h6 class="dropdown-header">Xin chào 👋</h6>
						<a href="/user/general" class="dropdown-item text-muted">Tài khoản: VSTEP203118</a>

						<div class="dropdown-divider"></div>
						<a href="/user/history" class="dropdown-item">📝 Lịch sử thi</a>
						<a href="/practice/history" class="dropdown-item">📊 Lịch sử luyện đề</a>
						<a href="/user/writing" class="dropdown-item">✍️ Bài thi viết</a>
						<a href="/user/speaking" class="dropdown-item">🎤 Bài thi nói</a>

						<div class="dropdown-divider"></div>
						<h6 class="dropdown-header">Chế độ hiển thị</h6>
						<div class="px-3 pb-2">
							<div class="btn-group w-100" role="group" aria-label="Chuyển chế độ hiển thị">
								<button class="btn btn-sm btn-outline-secondary" data-bs-theme-value="light" aria-label="Giao diện sáng">
									<i class="fe fe-sun"></i>
								</button>
								<button class="btn btn-sm btn-outline-secondary" data-bs-theme-value="dark" aria-label="Giao diện tối">
									<i class="fe fe-moon"></i>
								</button>
								<button class="btn btn-sm btn-outline-secondary active" data-bs-theme-value="auto" aria-label="Tự động">
									<i class="fe fe-monitor"></i>
								</button>
							</div>
						</div>

						<div class="dropdown-divider"></div>
						<a href="/user/logout" class="dropdown-item text-danger"><i class="fe fe-log-out me-2"></i> Đăng xuất</a>
					</div>
				</div>
					</div>


		<div class="collapse navbar-collapse me-lg-auto order-lg-0" id="navbar">

			<!-- Danh sách menu chính -->
			<ul class="navbar-nav me-lg-auto">

				<!-- Dropdown Luyện đề -->
				<li class="nav-item dropdown">
					<a class="nav-link fw-bold dropdown-toggle active" href="#" id="practiceSidebar" role="button" data-bs-toggle="dropdown">
						Luyện đề
					</a>
					<ul class="dropdown-menu" aria-labelledby="practiceSidebar">
						<li><a href="/practice" class="dropdown-item">Danh sách đề</a></li>
						<li><a href="/practice/listening" class="dropdown-item">Luyện đề nghe</a></li>
						<li><a href="/practice/reading" class="dropdown-item">Luyện đề đọc</a></li>
						<li><a href="/practice/writing" class="dropdown-item">Luyện đề viết</a></li>
						<li><a href="/practice/speaking" class="dropdown-item">Luyện đề nói</a></li>
					</ul>
				</li>

				
									<li class="nav-item">
						<a class="nav-link fw-bold " href="/exam">
							Thi thử						</a>
					</li>
									<li class="nav-item">
						<a class="nav-link fw-bold " href="/goi-on-luyen-cham-thi-vstep">
							Gói cước						</a>
					</li>
									<li class="nav-item">
						<a class="nav-link fw-bold " href="/lich-thi-vstep">
							Lịch thi						</a>
					</li>
									<li class="nav-item">
						<a class="nav-link fw-bold " href="/bai-viet-vstep">
							Bài viết						</a>
					</li>
				
			</ul>
		</div>

	</div>
</nav>
	<div class="bg-white border-bottom shadow-sm sticky-top z-1 px-3 py-2">
	<div class="container-fluid">
		<div class="row align-items-center text-center text-md-start">
			<!-- Trái: Nút quay lại -->
			<div class="col-12 col-md-3 mb-2 mb-md-0">
				<button id="btn-back" class="btn btn-outline-secondary btn-sm">
					⬅️ Quay lại danh sách đề
				</button>
			</div>

			<!-- Giữa: Thông tin đề -->
			<div class="col-12 col-md-6 text-center">
				<span class="fw-bold text-muted small d-block">
					🗣️ Bạn đang luyện đề nói mã số 03 - Part 3				</span>
				<span class="fw-bold text-muted small d-block">
					🆔 Mã bài làm: #S56601				</span>
			</div>

			<!-- Phải: Lời chào + nút dịch -->
			<div class="col-12 col-md-3 text-md-end">
				<span class="small text-muted fw-bold d-block">
					👋 Xin chào, phuneo				</span>
				<button id="toggleTranslationBtn" class="btn btn-outline-primary btn-sm mt-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasTranslation">
					🌐 Dịch tiếng Việt
				</button>
			</div>
		</div>
	</div>
</div>
	
	<div class="main-content pb-5 pb-md-7">

		
		<div class="container">
			
<!-- Offcanvas Translation -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasTranslation">
	<div class="offcanvas-header">
		<span class="offcanvas-title fw-bold">Dịch tiếng Việt</span>
		<button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
	</div>
	<div class="offcanvas-body">
		<p><strong>Chủ đề: Làm việc theo cặp giúp học sinh học tốt hơn ở trường.</strong><br>
			</p><div class="container">
				<div class="row align-items-center">
					<div class="col"></div>
					<div class="col">
						<div class="khoa-con bg-primary rounded text-white p-3 m-4 text-center">Gives students the opportunity to learn from others</div>
					</div>
					<div class="col"></div>
				</div>
				<div class="row align-items-center">
					<div class="col">
						<div class="khoa-con bg-primary rounded text-white p-3 m-4 text-center">Helps students become more active</div>
					</div>
					<div class="col">
						<div class="khoa-cha bg-primary rounded text-white fw-bold p-3 m-4 text-center">Pair work</div>
					</div>
					<div class="col">
						<div class="khoa-con bg-primary rounded text-white p-3 m-4 text-center">Your own ideas</div>
					</div>
				</div>
				<div class="row align-items-center">
					<div class="col"></div>
					<div class="col">
						<div class="khoa-con bg-primary rounded text-white p-3 m-4 text-center">Improves students' social skills and interaction</div>
					</div>
					<div class="col"></div>
				</div>
			</div>
		<br><strong>Câu hỏi gợi ý:</strong><br>1. Những tình huống nào ở trường nên áp dụng làm việc theo cặp? Tại sao?<br>2. Một số bất lợi khi làm việc theo cặp là gì?<br>3. Giáo viên có thể làm gì để nâng cao hiệu quả của các hoạt động làm việc theo cặp?<p></p>
	</div>
</div>

<div class="row mt-4">
	<div class="col-12">
		<div class="card">
			<div class="card-body">

				<!-- Câu hỏi -->
				<div class="bg-light rounded p-3 border mb-3">
					<b>Topic: Working in pairs helps students learn better at school.</b><br>
			<div class="container">
				<div class="row align-items-center">
					<div class="col"></div>
					<div class="col">
						<div class="map-child bg-primary rounded text-white p-3 m-4 text-center">Gives students the opportunity to learn from others</div>
					</div>
					<div class="col"></div>
				</div>
				<div class="row align-items-center">
					<div class="col">
						<div class="map-child bg-primary rounded text-white p-3 m-4 text-center">Helps students become more active</div>
					</div>
					<div class="col">
						<div class="map-parent bg-primary rounded text-white fw-bold p-3 m-4 text-center">Pair work</div>
					</div>
					<div class="col">
						<div class="map-child bg-primary rounded text-white p-3 m-4 text-center">Your own ideas</div>
					</div>
				</div>
				<div class="row align-items-center">
					<div class="col"></div>
					<div class="col">
						<div class="map-child bg-primary rounded text-white p-3 m-4 text-center">Improves students' social skills and interaction</div>
					</div>
					<div class="col"></div>
				</div>
			</div>
		<br><b>Follow-up questions:</b><br>1. In what situations should pair work be used at school, and why?<br>2. What are some possible disadvantages of working in pairs?<br>3. How can teachers improve the effectiveness of pair work activities?<br>				</div>

				<!-- Khu vực ghi âm -->
				<div class="d-flex justify-content-between align-items-center fw-bold my-4">
					<span>🎤 Ghi âm câu trả lời:</span>
					<span class="text-primary">⏱ Thời gian ghi âm tối đa cho Part 3 là 4 phút.</span>
				</div>

				<div class="progress my-2 position-relative" style="height: 38px;">
					<div id="recordProgress" class="progress-bar progress-bar-striped bg-danger" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
					</div>
					<div id="countdownDisplay" class="position-absolute top-50 start-50 translate-middle fw-bold fs-3 text-primary">
						⏱ --:--
					</div>
				</div>

				<canvas id="waveform" width="600" height="80" class="w-100 border rounded bg-light mb-3"></canvas>

				<div class="text-center d-flex justify-content-center flex-wrap gap-2">
					<button id="startBtn" class="btn btn-success">⏺ Bắt đầu ghi âm</button>
					<button id="stopBtn" class="btn btn-danger" disabled="">⏹ Dừng ghi âm</button>
				</div>

				<div class="text-center mt-3">
					<audio id="audioPlayback" controls=""></audio>
				</div>

				<div class="mt-2 text-center">
					<button id="uploadBtn" class="btn btn-primary fw-bold px-4">📤 Nộp bài</button>
				</div>

			</div>
		</div>
	</div>
</div>

		</div>

	</div>

	<script type="text/javascript" src="/assets/js/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/theme/dashkit/assets/js/theme.bundle.js"></script>
<script>
	function applyTheme(theme) {
		document.documentElement.setAttribute('data-bs-theme', theme);
		localStorage.setItem('theme', theme);

		// Cập nhật class active
		document.querySelectorAll('[data-bs-theme-value]').forEach(button => {
			if (button.getAttribute('data-bs-theme-value') === theme) {
				button.classList.add('active');
			} else {
				button.classList.remove('active');
			}
		});
	}

	// Gán sự kiện click cho các nút
	document.querySelectorAll('[data-bs-theme-value]').forEach(button => {
		button.addEventListener('click', function () {
			const theme = this.getAttribute('data-bs-theme-value');
			applyTheme(theme);
		});
	});

	// Khởi động: áp dụng theme đã lưu hoặc auto
	const savedTheme = localStorage.getItem('theme') || 'auto';
	applyTheme(savedTheme);
</script>

	<script type="text/javascript" src="/assets/jquery-connections/jquery.connections.js"></script>
<script>

$(document).ready(function() {
	$(".map-parent").connections({to: ".map-child"});
});

$(".vh-exam").scroll(function() {
	$(".map-parent").connections("update");
});

let mediaRecorder;
let audioChunks = [];
let audioBlob;
let timeoutId;
let countdownInterval;

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const uploadBtn = document.getElementById("uploadBtn");
const audioPlayback = document.getElementById("audioPlayback");
const countdownDisplay = document.getElementById("countdownDisplay");

// 🕒 Thời lượng tối đa theo part
const maxDurations = { 1: 180, 2: 180, 3: 240 };
const speakingPart = 3;
const maxDuration = maxDurations[speakingPart] ?? 180;

startBtn.addEventListener("click", async () => {
	const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

	// 🎵 Khởi tạo AudioContext và vẽ sóng âm
	const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
	const source = audioCtx.createMediaStreamSource(stream);
	const analyser = audioCtx.createAnalyser();
	analyser.fftSize = 512;
	source.connect(analyser);

	const canvas = document.getElementById("waveform");
	const canvasCtx = canvas.getContext("2d");

	const bufferLength = analyser.fftSize;
	const dataArray = new Uint8Array(bufferLength);

	function drawWaveform() {
		requestAnimationFrame(drawWaveform);

		analyser.getByteTimeDomainData(dataArray);

		// Clear canvas
		canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

		canvasCtx.lineWidth = 1.5;
		canvasCtx.strokeStyle = '#007bff'; // xanh dương dịu

		canvasCtx.beginPath();

		const sliceWidth = canvas.width / bufferLength;
		let x = 0;

		for (let i = 0; i < bufferLength; i++) {
			const v = dataArray[i] / 128.0; // Chuẩn hóa về khoảng [0, 2]
			const y = v * canvas.height / 2;

			if (i === 0) {
				canvasCtx.moveTo(x, y);
			} else {
				canvasCtx.lineTo(x, y);
			}
			x += sliceWidth;
		}

		canvasCtx.lineTo(canvas.width, canvas.height / 2);
		canvasCtx.stroke();
	}

	// Gọi bắt đầu vẽ sóng
	drawWaveform();

	mediaRecorder = new MediaRecorder(stream);
	audioChunks = [];

	mediaRecorder.ondataavailable = event => {
		if (event.data.size > 0) {
			audioChunks.push(event.data);
		}
	};

	mediaRecorder.onstop = () => {
		audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
		audioPlayback.src = URL.createObjectURL(audioBlob);

		clearTimeout(timeoutId);
		clearInterval(countdownInterval);
		countdownDisplay.textContent = "⏱ Đã kết thúc";
		document.getElementById("recordProgress").style.width = "100%";
		document.getElementById("recordProgress").classList.remove("bg-danger");
		document.getElementById("recordProgress").classList.add("bg-success");

		canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

	};

	mediaRecorder.start();
	startBtn.disabled = true;
	stopBtn.disabled = false;

	// ⏱ Bắt đầu đếm ngược
	startCountdown(maxDuration);

	// ⏱ Tự động dừng khi hết thời gian
	timeoutId = setTimeout(() => {
		if (mediaRecorder && mediaRecorder.state === "recording") {
			mediaRecorder.stop();
			alert(`⏰ Đã đạt thời gian tối đa ${maxDuration / 60} phút. Ghi âm sẽ tự động dừng.`);
			startBtn.disabled = false;
			stopBtn.disabled = true;
		}
	}, maxDuration * 1000);
});

stopBtn.addEventListener("click", () => {
	if (mediaRecorder && mediaRecorder.state === "recording") {
		mediaRecorder.stop();
	}
	startBtn.disabled = false;
	stopBtn.disabled = true;
	clearTimeout(timeoutId);
	clearInterval(countdownInterval);
	countdownDisplay.textContent = "⏱ Đã kết thúc";
});

uploadBtn.addEventListener("click", (e) => {

	if (!audioBlob) {
		alert("❌ Vui lòng ghi âm trước khi nộp bài.");
		return;
	}

	let formData = new FormData();
	formData.append('audio_file', audioBlob, 'speaking_56601.webm');
	formData.append('practice_id', 56601);

	fetch('/practice/speaking/submit/56601', {
		method: 'POST',
		body: formData
	})
	.then(response => response.json())
	.then(result => {
		if (result.success) {
			alert("✅ Bài nói đã được nộp thành công.");
			window.location.href = "/practice/speaking/review/" + result.practice_id;
		} else {
			alert("❌ " + result.message);
		}
	})
	.catch(error => {
		console.error('Lỗi khi gửi bài:', error);
		alert("❌ Lỗi khi gửi bài. Vui lòng thử lại.");
	});
});

// 🎯 Hàm đếm ngược
function startCountdown(seconds) {
	let remaining = seconds;
	updateCountdownDisplay(remaining);
	updateProgressBar(remaining, seconds);

	countdownInterval = setInterval(() => {
		remaining--;
		if (remaining <= 0) {
			clearInterval(countdownInterval);
			return;
		}
		updateCountdownDisplay(remaining);
		updateProgressBar(remaining, seconds);
	}, 1000);
}

function updateProgressBar(current, total) {
	const percent = Math.round(100 * (1 - current / total));
	const bar = document.getElementById("recordProgress");
	bar.style.width = percent + '%';
	bar.setAttribute('aria-valuenow', percent);
}

function updateCountdownDisplay(seconds) {
	const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
	const secs = String(seconds % 60).padStart(2, '0');
	countdownDisplay.textContent = `⏱ ${mins}:${secs}`;
}

document.getElementById('btn-back').addEventListener('click', function () {
	const confirmed = confirm("Bạn vẫn chưa nộp bài.\nBạn có chắc chắn muốn quay lại danh sách đề không?");
	if (confirmed) {
		window.location.href = "/practice/speaking";
	}
});
</script>


</body><connection class="connection" style="border-radius: 0px; position: absolute; border-width: 0px 0px 0px 2px; left: 631.508px; top: 312.641px; width: 0px; height: 48px;"></connection><connection class="connection" style="border-radius: 0px; position: absolute; border-width: 2px 0px 0px; left: 423.172px; top: 382.891px; width: 72px; height: 0px;"></connection><connection class="connection" style="border-radius: 0px; position: absolute; border-width: 2px 0px 0px; left: 769.844px; top: 382.891px; width: 72px; height: 0px;"></connection><connection class="connection" style="border-radius: 0px; position: absolute; border-width: 0px 0px 0px 2px; left: 631.508px; top: 407.141px; width: 0px; height: 48px;"></connection></html>